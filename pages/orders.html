<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TableTop | Orders</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="../index.html" class="flex items-center space-x-2">
                    <i class="fas fa-utensils text-amber-600 text-2xl"></i>
                    <h1 class="text-2xl font-bold text-amber-600">TableTop</h1>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="menu.html" class="text-gray-700 hover:text-amber-600 transition-colors">Menu</a>
                    <a href="reservations.html" class="text-gray-700 hover:text-amber-600 transition-colors">Reservations</a>
                    <a href="orders.html" class="text-amber-600 font-semibold border-b-2 border-amber-600">Orders</a>
                    <a href="login.html" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg transition-colors shadow-md login-btn">Login</a>
                    <button id="mobile-menu-button" class="md:hidden text-gray-700"><i class="fas fa-bars text-2xl"></i></button>
                </div>
            </div>
            <div id="mobile-menu" class="md:hidden hidden py-4 border-t border-gray-100">
                <a href="menu.html" class="block py-2 text-gray-700 hover:text-amber-600">Menu</a>
                <a href="reservations.html" class="block py-2 text-gray-700 hover:text-amber-600">Reservations</a>
                <a href="orders.html" class="block py-2 text-amber-600 font-semibold border-b-2 border-amber-600">Orders</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold mb-6">Current Orders</h2>
            <div id="ordersContainer" class="space-y-4"></div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-16 mt-20">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <div>
                    <h4 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-utensils text-amber-500 mr-3"></i>
                        TableTop
                    </h4>
                    <p class="text-gray-400 mb-6">Experience fine dining at its best with our award-winning cuisine and exceptional service.</p>
                    <div class="flex space-x-5">
                        <a href="https://github.com/PavanMeka09/TableTop" target="_blank" class="text-gray-400 hover:text-amber-500 transition-colors">
                            <i class="fa-brands fa-github text-3xl"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-6">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="menu.html" class="text-gray-400 hover:text-amber-500 transition-colors flex items-center"><i class="fas fa-chevron-right mr-2 text-amber-500"></i> Our Menu</a></li>
                        <li><a href="reservations.html" class="text-gray-400 hover:text-amber-500 transition-colors flex items-center"><i class="fas fa-chevron-right mr-2 text-amber-500"></i> Reservations</a></li>
                        <li><a href="orders.html" class="text-amber-500 flex items-center"><i class="fas fa-chevron-right mr-2 text-amber-500"></i> Orders</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-8 text-center">
                <p class="text-gray-400">&copy; 2025 TableTop. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });
        // Session check and UI update
        async function checkSessionAndUpdateUI() {
            const nav = document.querySelector('nav .flex.items-center.space-x-4');
            let loginBtn = nav.querySelector('a.login-btn');
            let logoutBtn = nav.querySelector('.logout-btn');
            if (logoutBtn) logoutBtn.remove();
            try {
                const res = await fetch('../backend/auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ action: 'check_session' })
                });
                const data = await res.json();
                if (data.logged_in) {
                    if (loginBtn) loginBtn.style.display = 'none';
                    const logout = document.createElement('a');
                    logout.textContent = 'Logout';
                    logout.href = '#';
                    logout.className = 'bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg transition-colors shadow-md logout-btn';
                    logout.onclick = async function(e) {
                        e.preventDefault();
                        await fetch('../backend/auth.php', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: new URLSearchParams({ action: 'logout' })
                        });
                        window.location.href = '../index.html';
                    };
                    nav.appendChild(logout);
                } else {
                    if (loginBtn) loginBtn.style.display = '';
                }
            } catch (e) {
                if (loginBtn) loginBtn.style.display = '';
            }
        }
        document.addEventListener('DOMContentLoaded', checkSessionAndUpdateUI);
        // Toast feedback
        function showToast(msg, type = 'info') {
            let toast = document.createElement('div');
            toast.className = `fixed bottom-8 right-8 z-50 px-6 py-3 rounded shadow-lg text-white font-semibold ${type === 'error' ? 'bg-red-600' : type === 'success' ? 'bg-green-600' : 'bg-amber-600'}`;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 3000);
        }
        async function fetchOrders() {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '<div class="text-center py-8 text-gray-400">Loading orders...</div>';
            try {
                const res = await fetch('../backend/order.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ action: 'get_orders' })
                });
                const data = await res.json();
                if (data.error) {
                    showToast(data.error, 'error');
                    container.innerHTML = '<p class="text-gray-600 text-center py-8">No orders found</p>';
                    return;
                }
                if (!Array.isArray(data) || data.length === 0) {
                    container.innerHTML = '<p class="text-gray-600 text-center py-8">No orders found</p>';
                    return;
                }
                container.innerHTML = '';
                data.forEach(order => {
                    const div = document.createElement('div');
                    div.className = 'bg-white p-4 rounded shadow';
                    const statusColor = {
                        'pending': 'bg-yellow-100',
                        'preparing': 'bg-amber-100',
                        'on the way': 'bg-blue-100',
                        'delivered': 'bg-green-100'
                    }[order.status] || 'bg-gray-100';
                    div.innerHTML = `
                        <div class="flex justify-between mb-4">
                            <h3 class="font-bold">Order #${order.id}</h3>
                            <span class="${statusColor} px-2 py-1 rounded-full text-sm">${order.status}</span>
                        </div>
                        <p class="text-xl font-bold text-amber-600 mb-2">â‚¹${order.total_price}</p>
                        <p class="text-sm text-gray-600">Ordered on: ${new Date(order.created_at).toLocaleString()}</p>
                    `;
                    container.appendChild(div);
                });
            } catch (e) {
                showToast('Failed to load orders', 'error');
                container.innerHTML = '<p class="text-gray-600 text-center py-8">No orders found</p>';
            }
        }
        document.addEventListener('DOMContentLoaded', fetchOrders);
    </script>
</body>
</html>